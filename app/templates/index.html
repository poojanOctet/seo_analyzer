<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Generate SEO-optimized articles using AI and Wikipedia knowledge">
    <title>AI Content Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("contentForm");
            const resultSection = document.getElementById("result");
            const articleTitle = document.getElementById("articleTitle");
            const articleMeta = document.getElementById("articleMeta");
            const articleContent = document.getElementById("articleContent");

            form.addEventListener("submit", async function (event) {
                event.preventDefault(); // Prevent form submission

                // Get form values
                const topic = document.getElementById("topic").value;
                const keyword = document.getElementById("keyword").value;
                const length = document.getElementById("length").value;

                // API request payload
                const requestData = { topic, keyword, length };

                try {
                    // Call API to generate article
                    const response = await fetch("/generate-content", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(requestData)
                    });

                    if (!response.ok) {
                        throw new Error("Failed to generate article.");
                    }

                    const data = await response.json();

                    // Set title & meta
                    articleTitle.textContent = data.title;
                    articleMeta.textContent = data.meta;

                    // Format content (Convert markdown-like text to proper HTML)
                    const formattedContent = formatArticleContent(data.content);
                    articleContent.innerHTML = formattedContent;

                    resultSection.classList.remove("hidden"); // Show result section
                } catch (error) {
                    alert("Error: " + error.message);
                }
            });

            // Function to format content
            function formatArticleContent(text) {
                return text
                    .replace(/###\s?(.*?)(\n|$)/g, "<h3>$1</h3>") // Convert ### to <h3>
                    .replace(/##\s?(.*?)(\n|$)/g, "<h2>$1</h2>") // Convert ## to <h2>
                    .replace(/\n{2,}/g, "</p><p>") // Convert double newlines to paragraphs
                    .replace(/\n/g, "<br>") // Convert single newline to <br>
                    .replace(/^<p>/, "") // Remove leading <p> if exists
                    .replace(/<\/p>$/, ""); // Remove trailing </p> if exists
            }
        });

    </script>
</head>

<body>
    <header>
        <h1>AI Content Generator</h1>
    </header>

    <main>
        <section class="generator-form">
            <h2>Generate Your Article</h2>
            <form id="contentForm">
                <div class="form-group">
                    <label for="topic">Topic:</label>
                    <input type="text" id="topic" name="topic" required placeholder="e.g., Artificial Intelligence">
                </div>

                <div class="form-group">
                    <label for="keyword">Target Keyword:</label>
                    <input type="text" id="keyword" name="keyword" required placeholder="e.g., AI technology">
                </div>

                <div class="form-group">
                    <label for="length">Article Length (words):</label>
                    <input type="number" id="length" name="length" value="1000" min="500" max="2000">
                </div>

                <button type="submit">Generate Article</button>
            </form>
        </section>

        <section id="result">
            <h2>Generated Article</h2>
            <div class="article-meta">
                <p><strong>Title: </strong><span id="articleTitle"></span></p>
                <p><strong>Meta Description: </strong><span id="articleMeta"></span></p>
            </div>
            <div id="articleContent"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 AI Content Generator. All rights reserved.</p>
    </footer>
</body>

</html>
